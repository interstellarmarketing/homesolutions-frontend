---
import { shortTradesConst, type ShortTradeEnum } from "@models/estimateOptions";
import { getFirstStep } from "@consts/index";
import { appendQueryParams } from "@utils/queryParams";

/**
 * This is the entry point for estimate flows
 * It redirects to the first step in the flow based on the estimate type
 * URL parameters are passed along to the first step
 */

// Get estimate type from URL
const { estimateType } = Astro.params;

// Validate estimate type
if (
  !estimateType ||
  !shortTradesConst.includes(estimateType as ShortTradeEnum)
) {
  return Astro.redirect("/");
}

// Determine first step based on estimate type
let firstStep = getFirstStep(estimateType as ShortTradeEnum);

const searchParams = Astro.url.searchParams;

if (!searchParams.has("reset")) {
  searchParams.append("reset", "true");
}

// Redirect to first step with query params preserved
const redirectUrl = `/estimate/${estimateType}/${firstStep}`;
return Astro.redirect(appendQueryParams(redirectUrl, searchParams));
---

<!-- 
This page serves as a router only and will redirect to the appropriate first step
No Astro component is rendered
-->
