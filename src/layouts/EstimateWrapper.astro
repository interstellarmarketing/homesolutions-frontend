---
import { estimateStore } from "@stores/estimateProgress";
import { activeEstimateTypeStore } from "@stores/activeEstimateType";
import Layout from "./Layout.astro";
import { shortTradeEnum } from "@assets/info/estimateOptions";

interface Props {
	title: string;
	estimateType: string;
}

const activeEstimate = estimateStore.get();
const activeEstimateType = activeEstimateTypeStore.get();

//console.log({ activeEstimate });

let { title, estimateType } = Astro.props;

const parseEstimateType = shortTradeEnum.safeParse(estimateType);

if (parseEstimateType.success) {
	estimateType = parseEstimateType.data;
} else {
	return Astro.redirect("/");
}

// INFO: handle switching routes
if (estimateType !== activeEstimate.estimateType) {
	const { estimateAction, ...existingRest } = activeEstimate;
	estimateStore.set({ ...existingRest, estimateType });
}

if (parseEstimateType.data !== activeEstimateType) {
	activeEstimateTypeStore.set(parseEstimateType.data);
}
---

<Layout title={title}>
	<slot />
</Layout>
