---
import { estimateStore } from "@stores/estimateProgress";
import { activeEstimateTypeStore } from "@stores/activeEstimateType";
import Layout from "./Layout.astro";
import { actions } from "astro:actions";

interface Props {
	title: string;
	estimateType: string;
}

const activeEstimate = estimateStore.get();
const activeEstimateType = activeEstimateTypeStore.get();

//console.log({ activeEstimate });

const { title, estimateType } = Astro.props;

// INFO: handle switching routes
if (estimateType !== activeEstimate.estimateType) {
	const { estimateAction, ...existingRest } = activeEstimate;
	estimateStore.set({ ...existingRest, estimateType });
}

if (estimateType !== activeEstimateType?.shortTrade) {
	const { data: getEstimateType, error } = await Astro.callAction(
		actions.estimateOptions.estimateOptionsReformatted,
		{ shortTrade: estimateType },
	);

	if (error) {
		throw new Error("failed to fetch details of estimateType");
	} else {
		activeEstimateTypeStore.set(getEstimateType);
	}
}

//console.log({
//	activeEstimate: estimateStore.get(),
//	activeEstimateType: activeEstimateTypeStore.get(),
//});
---

<Layout title={title}>
	<slot />
</Layout>
